<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MediCart - Checkout</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="./Footer/footer.css">
  <style>
    body { font-family: 'Inter', sans-serif; background: #f8fafc; }
    .collapsible { transition: all 0.4s ease; }
    .collapsible-content { max-height: 0; overflow: hidden; transition: max-height 0.5s ease; }
    .collapsible.open .collapsible-content { max-height: 2000px; }
    .collapsible-header { cursor: pointer; user-select: none; }
    input, select { @apply border border-gray-300 rounded-lg px-4 py-3 focus:border-blue-500 focus:ring-2 focus:ring-blue-100; }
  </style>
</head>
<body class="bg-gray-50 mt-32">

  <div id="header-placeholder"></div>

  <main class="container mx-auto px-4 py-6 max-w-6xl">
    <h1 class="text-2xl font-semibold text-gray-800 mb-6 text-center">Checkout</h1>

    <div class="grid lg:grid-cols-3 gap-6">

      <!-- LEFT: Order Items (Collapsible) -->
      <div class="lg:col-span-2 space-y-4">
        <!-- Items -->
        <div class="bg-white rounded-xl shadow-sm border collapsible open">
          <div class="collapsible-header p-5 flex justify-between items-center border-b" onclick="toggleSection(this)">
            <h3 class="font-semibold text-gray-800 flex items-center">
              <i class="fas fa-box mr-3 text-blue-600"></i>
              Your Items (<span id="item-count">0</span>)
            </h3>
            <i class="fas fa-chevron-down transition-transform duration-300"></i>
          </div>
          <div class="collapsible-content p-5 space-y-4">
            <div id="order-items"></div>
          </div>
        </div>

        <!-- Order Summary (Collapsible) -->
        <div class="bg-white rounded-xl shadow-sm border collapsible open">
          <div class="collapsible-header p-5 flex justify-between items-center border-b" onclick="toggleSection(this)">
            <h3 class="font-semibold text-gray-800 flex items-center">
              <i class="fas fa-receipt mr-3 text-green-600"></i>
              Order Summary
            </h3>
            <i class="fas fa-chevron-down transition-transform duration-300"></i>
          </div>
          <div class="collapsible-content p-5">
            <div class="space-y-3 text-sm">
              <div class="flex justify-between"><span>Subtotal</span><span id="subtotal">₹0.00</span></div>
              <div class="flex justify-between"><span>Shipping</span><span id="shipping">₹49.00</span></div>
              <div class="flex justify-between text-green-600 font-medium"><span>Discount</span><span>-₹0.00</span></div>
              <div class="border-t pt-3 mt-3">
                <div class="flex justify-between text-lg font-bold">
                  <span>Total</span>
                  <span class="text-blue-600" id="total">₹0.00</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- RIGHT: Forms (Collapsible) -->
      <div class="space-y-4">

        <!-- Delivery Address -->
        <div class="bg-white rounded-xl shadow-sm border collapsible open">
          <div class="collapsible-header p-5 flex justify-between items-center border-b" onclick="toggleSection(this)">
            <h3 class="font-semibold text-gray-800 flex items-center">
              <i class="fas fa-map-marker-alt mr-3 text-blue-600"></i>
              Delivery Address
            </h3>
            <i class="fas fa-chevron-down transition-transform duration-300"></i>
          </div>
          <div class="collapsible-content p-5">
            <form id="addressForm" class="space-y-4 text-sm">
              <div class="grid grid-cols-2 gap-3">
                <input type="text" placeholder="Full Name" required>
                <input type="tel" placeholder="Phone" required pattern="[0-9]{10}">
              </div>
              <input type="text" placeholder="Flat / House No." required>
              <input type="text" placeholder="Area / Street" required>
              <div class="grid grid-cols-2 gap-3">
                <input type="text" placeholder="Pincode" id="pincode" required maxlength="6">
                <input type="text" placeholder="City" required>
              </div>
              <input type="text" placeholder="State" required>
            </form>
          </div>
        </div>

        <!-- Payment Method -->
        <div class="bg-white rounded-xl shadow-sm border collapsible open">
          <div class="collapsible-header p-5 flex justify-between items-center border-b" onclick="toggleSection(this)">
            <h3 class="font-semibold text-gray-800 flex items-center">
              <i class="fas fa-credit-card mr-3 text-green-600"></i>
              Payment Method
            </h3>
            <i class="fas fa-chevron-down transition-transform duration-300"></i>
          </div>
          <div class="collapsible-content p-5 space-y-4">
            <label class="flex items-center p-4 border rounded-lg cursor-pointer hover:bg-blue-50">
              <input type="radio" name="pay" value="cod" checked class="mr-4">
              <div>
                <p class="font-medium">Cash on Delivery (COD)</p>
                <p class="text-xs text-gray-600">Pay when you receive</p>
              </div>
            </label>

            <label class="flex items-center p-4 border rounded-lg cursor-pointer hover:bg-blue-50">
              <input type="radio" name="pay" value="qr" class="mr-4">
              <div>
                <p class="font-medium">UPI / QR Code</p>
                <p class="text-xs text-gray-600">Google Pay, PhonePe, etc.</p>
              </div>
            </label>

            <div id="qr-box" class="hidden text-center p-6 bg-gray-50 rounded-lg">
              <img src="https://via.placeholder.com/200x200/2563eb/ffffff?text=Scan+QR" class="mx-auto rounded-lg shadow">
              <p class="mt-3 font-semibold text-blue-600">₹<span id="qr-amount">0.00</span></p>
            </div>
          </div>
        </div>

        <!-- Place Order Button -->
        <button onclick="placeOrder()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 rounded-xl shadow-lg transition">
          Place Order • ₹<span id="final-total">0.00</span>
        </button>
      </div>
    </div>
  </main>

  <div id="footer-placeholder"></div>

  <script>
    function getCart() {
      return JSON.parse(localStorage.getItem('cart') || '[]');
    }

    function loadHeader() {
      fetch('../Header/header.html')
        .then(r => r.ok ? r.text() : '')
        .then(html => {
          document.getElementById('header-placeholder').innerHTML = html;
          const script = document.createElement('script');
          script.src = '../Header/header.js';
          document.body.appendChild(script);
        });
    }

    function loadFooter() {
      fetch('../Footer/footer.html')
        .then(r => r.ok ? r.text() : '')
        .then(html => document.getElementById('footer-placeholder').innerHTML = html);
    }

    function toggleSection(header) {
      const collapsible = header.parentElement;
      collapsible.classList.toggle('open');
      const icon = header.querySelector('i:last-child');
      icon.classList.toggle('rotate-180');
    }

    function updateCheckout() {
      const cart = getCart();
      if (cart.length === 0) {
        alert("Cart is empty!");
        window.location.href = "cart.html";
        return;
      }

      const subtotal = cart.reduce((s, i) => s + i.price * i.quantity, 0);
      const shipping = subtotal >= 499 ? 0 : 49;
      const total = subtotal + shipping;

      document.getElementById('item-count').textContent = cart.reduce((s, i) => s + i.quantity, 0);
      document.getElementById('subtotal').textContent = `₹${subtotal.toFixed(2)}`;
      document.getElementById('shipping').textContent = shipping === 0 ? 'Free' : '₹49.00';
      document.getElementById('total').textContent = `₹${total.toFixed(2)}`;
      document.getElementById('final-total').textContent = total.toFixed(2);
      document.getElementById('qr-amount').textContent = total.toFixed(2);

      document.getElementById('order-items').innerHTML = cart.map(item => `
        <div class="flex gap-4 items-center p-4 bg-gray-50 rounded-lg">
          <img src="${item.image || 'https://via.placeholder.com/60'}" class="w-16 h-16 rounded object-cover">
          <div class="flex-1">
            <p class="font-medium text-sm">${item.name}</p>
            <p class="text-xs text-gray-600">₹${item.price} × ${item.quantity}</p>
          </div>
          <p class="font-semibold text-blue-600">₹${(item.price * item.quantity).toFixed(2)}</p>
        </div>
      `).join('');
    }

    // Show QR when selected
    document.querySelectorAll('input[name="pay"]').forEach(r => {
      r.addEventListener('change', () => {
        document.getElementById('qr-box').classList.toggle('hidden', r.value !== 'qr');
      });
    });

    function placeOrder() {
      if (!document.getElementById('addressForm').checkValidity()) {
        alert("Please fill all required fields");
        return;
      }
      alert("Order placed successfully! Thank you!");
      localStorage.removeItem('cart');
      window.location.href = "order-success.html";
    }

    document.addEventListener('DOMContentLoaded', () => {
      loadHeader();
      loadFooter();
      updateCheckout();
    });
  </script>
</body>
</html>